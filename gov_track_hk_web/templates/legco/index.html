{% extends 'legco/base.html'%}
{% block page_content%}
<div style="width:40%">
<div style="width:40%;margin-left:10px;float:left">
<h3>最新投票結果</h3>
<table id="latest-votes">
 <thead style="display:none">
  <tr></tr>
 </thead>
</table>
</div>
<div style="width:40%;float:left">

    <h2>最常缺席議員</h2>
    <div class="panel panel-default">
    <div class="panel-body">
        <table id="most-absent" class="cell-border">
            <thead>
            <tr>
                <th width="50%">議員</th>
                <th width="50%">缺席會議次數</th>
            </tr>
            </thead>
        </table>
    </div>
    </div>
    </div>
</div>
<div style="width:40%;float:left;margin-left:10px;">

    <h2>最新法案</h2>
    <div class="panel panel-default">
    <div class="panel-body">
        <table id="latest-bills" class="cell-border">
            <thead>
            <tr>
                <th width="50%">法案</th>
            </tr>
            </thead>
        </table>
    </div>
    </div>
    </div>
</div>

<script>
$(document).ready(function() {
    $('#latest-votes').DataTable( {
        "ajax": { 
            url:"/api/latest_votes/",
            dataSrc:""
        },
        "searching": false,
        "paging": false,
        "ordering": false,
        "info": false,
        "columns": [
            { "render": 
                function ( data, type, row ) {
                    console.log(row);
                    var label_class = "label-primary";
                    var overall_result = row.summaries.filter(function(s) {return s.     summary_type == "OVER";})[0].result;
                    if (overall_result == "Passed")
                    {
                        label_class = "label-success";
                    }
                    else
                    if (overall_result == "Negatived")
                    {
                        label_class = "label-danger"
                    }
                    var s = "";
                    
                        
                    s += "<div class=\"panel panel-default\">";
                    s += "<div class=\"panel-heading\">" + row.date + " "  + row.time + "</div>";

                    s += "<div class=\"panel-body\" style=\"font-size:10pt\">" + row.motion.name_ch ;
                    s += "<br/><div style=\"margin-bottom:7px;margin-top:7px;\">結果: <span class=\"label " + label_class + "\">" + overall_result +  "</span></div>"
                    s += "動議人: " + row.motion.mover_ch ;

                    s += "<a class=\"btn-block\" href=\"/legco/vote/" + row.id  + "/\">"
                    s += "Go";
                    s += "</a>";
                    s += "</div>"
                    s += "</div>";

                    return s;
                }
            },
        ]
    } );
} );
</script>

<script>
$(document).ready(function() {
    $('#most-absent').DataTable( {
        "ajax": { 
            url:"/api/most_absent/",
            dataSrc:""
        },
        "searching": false,
        "paging": false,
        "ordering": false,
        "info": false,
        "columns": [
            { "data": "individual.name" },
            { "data": "count" },
        ]
    } );
} );
</script>

<script>
$(document).ready(function() {
    $('#latest-bills').DataTable( {
        "ajax": { 
            url:"/api/latest_bills/",
            dataSrc:""
        },
        "searching": false,
        "paging": false,
        "ordering": false,
        "info": false,
        "columns": [
            { "render":
                function ( data, type, row ) {
                    var html = "<a href=\"/legco/bill/" + row['id'] + "\">" + row['title_ch'] + "</a>";
                    return html;
                },
            }
        ]
    } );
} );
</script>
{% endblock %}
